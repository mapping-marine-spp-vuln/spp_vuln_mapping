---
title: "Compare cumulative impact across regions and methods"
author: "*Compiled on `r date()` by `r Sys.info()['user']`*"
output: 
  html_document:
    code_folding: hide
    toc: true
    toc_depth: 3
    toc_float: yes
    number_sections: true
    theme: cerulean
    highlight: haddock
    includes: 
      in_header: '~/github/src/templates/ohara_hdr.html'
  pdf_document:
    toc: true
---

``` {r setup, echo = TRUE, message = FALSE, warning = FALSE}

knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, fig.height = 4, fig.width = 7)

library(terra)
library(oharac)
library(data.table)
library(tidyverse)
library(cowplot)
library(showtext) ### for custom fonts
library(here)
source(here('common_fxns.R'))

font_add(family = 'bentonbold', 
         regular = file.path('~/fonts', 
                             'BentonSans Condensed Bold', 
                             'BentonSans Condensed Bold.otf'))
font_add(family = 'benton', 
         regular = file.path('~/fonts', 
                             'BentonSans Condensed Book', 
                             'BentonSans Condensed Book.otf'))
showtext_auto()
```

# Summary

Examine distribution of impacts within regions (EEZ, MEOW, etc)

# Methods

Cumulative impact as the starting point; then perhaps break out by climate, land-based, ocean-based, and fishing stressors.  

## Load cumulative impact rasters

Build up an analysis dataframe including all three CHI maps.  Include additional layers to facilitate examination of impacts by coastal (i.e., neritic) vs. open ocean, as well as by EEZ and MEOW.  Include a layer of species richness to drop any instances where species count falls below some threshold, to ensure impact scores are based on a reasonable number of species (e.g., 20 spp).

```{r build chi dataframe}
chi_fs <- list.files(here('_output/cumulative_impact_maps'), pattern = 'chi_.+.tif',
                     full.names = TRUE)
chi_fs <- chi_fs[!str_detect(chi_fs, 'species_group')]

lyr_names <- basename(chi_fs) %>% str_remove('.tif') %>%
  str_replace('(chi_)?funct_entity(_group_chi)?', 'chi_fe') %>%
  str_replace('(chi_)?habitat(_group_chi)?', 'chi_hab')
chi_stack_all <- rast(chi_fs) %>%
  setNames(lyr_names)

chi_stack <- chi_stack_all[[str_detect(names(chi_stack_all), '^chi_[a-z]+$')]]
chi_cc_stack <- chi_stack_all[[str_detect(names(chi_stack_all), '_climate')]]
chi_noncc_stack_hab <- chi_stack_all[[str_detect(names(chi_stack_all), 'chi_hab_(f|o|l)')]] %>%
  sum(na.rm = TRUE) %>%
  setNames('chi_hab_noncc')
chi_noncc_stack_fe  <- chi_stack_all[[str_detect(names(chi_stack_all), 'chi_fe_(f|o|l)')]] %>%
  sum(na.rm = TRUE) %>%
  setNames('chi_fe_noncc')

nspp_r <- rast(here('_output/nspp_maps/species_richness.tif')) %>%
  setNames('nspp')
coastal_r <- rast(here('_spatial/bathy_mol_neritic.tif')) %>%
  setNames('coastal')
eez_r <- rast(here('_spatial/eez_mol.tif')) %>%
  setNames('eez')
meow_r <- rast(here('_spatial/meow_rgns_mol.tif')) %>%
  setNames('meow')

chi_df <- data.frame(values(chi_stack),
                     values(chi_cc_stack),
                     values(chi_noncc_stack_hab),
                     values(chi_noncc_stack_fe),
                     values(nspp_r),
                     values(coastal_r),
                     values(eez_r),
                     values(meow_r)) %>%
  mutate(cell_id = 1:n()) %>%
  ### note this also filters out cells where nspp is NA:
  filter(nspp >= 20)
```

## Examine impacts by ecoregion

```{r SI figure by province, fig.height = 8}
meow_prov_df <- foreign::read.dbf(here('_spatial/meow_rgns/meow_rgns.dbf')) %>%
  janitor::clean_names() %>%
  arrange(prov_code) %>%
  mutate(realm_lbl = str_replace(realm, 'Temperate', 'Tmp'),
         realm_lbl = str_replace(realm_lbl, 'Tropical', 'Tr'),
         realm_lbl = str_replace(realm_lbl, 'Northern', 'N'),
         realm_lbl = str_replace(realm_lbl, 'Western', 'W'),
         realm_lbl = str_replace(realm_lbl, 'Eastern', 'E'),
         realm_lbl = str_replace(realm_lbl, 'South(ern)?', 'S'),
         realm_lbl = str_replace(realm_lbl, 'Central', 'C'),
         realm_lbl = str_replace(realm_lbl, 'Atlantic', 'Atl'),
         realm_lbl = str_replace(realm_lbl, 'Pacific', 'Pac'),
         realm_lbl = str_replace(realm_lbl, 'Africa', 'Afr'),
         realm_lbl = str_replace(realm_lbl, 'America', 'Amer'),
         realm_lbl = str_replace(realm_lbl, 'Australasia', 'Aus'),
         realm_lbl = fct_inorder(realm_lbl)) %>%
  mutate(prov_lbl = str_replace(province, 'Temperate', 'Temp'),
         prov_lbl = str_replace(prov_lbl, 'Tropical', 'Trop'),
         prov_lbl = str_replace(prov_lbl, 'North(ern)?', 'N'),
         prov_lbl = str_replace(prov_lbl, '(W|w)est(ern)?', 'W'),
         prov_lbl = str_replace(prov_lbl, '(E|e)ast(ern)?(?!er)', 'E'),
         prov_lbl = str_replace(prov_lbl, 'South(ern)?', 'S'),
         prov_lbl = str_replace(prov_lbl, 'Islands', 'Is'),
         prov_lbl = str_replace(prov_lbl, ', | and ', '/'),
         # prov_lbl = str_replace(prov_lbl, 'Central', 'C'),
         # prov_lbl = str_replace(prov_lbl, 'Atlantic', 'Atl'),
         # prov_lbl = str_replace(prov_lbl, 'Pacific', 'Pac'),
         # prov_lbl = str_replace(prov_lbl, 'Africa', 'Afr'),
         # prov_lbl = str_replace(prov_lbl, 'America', 'Amer'),
         # prov_lbl = str_replace(prov_lbl, 'Australasia', 'Aus'),
         prov_lbl = fct_inorder(prov_lbl))

meow_prov_chi_df <- chi_df %>%
  left_join(meow_prov_df, by = c('meow' = 'eco_code_x')) %>%
  mutate(chi_fe          = ntile(chi_fe, n = 1000) / 10,
         chi_hab         = ntile(chi_hab, n = 1000) / 10,
         chi_fe_climate  = ntile(chi_fe_climate, n = 1000) / 10,
         chi_hab_climate = ntile(chi_hab_climate, n = 1000) / 10,
         chi_fe_noncc    = ntile(chi_fe_noncc, n = 1000) / 10,
         chi_hab_noncc   = ntile(chi_hab_noncc, n = 1000) / 10) %>%
  ### In each realm, order by highest to lowest mean impact
  group_by(prov_lbl) %>%
  mutate(mean_fe = mean(chi_fe)) %>%
  ungroup() %>%
  arrange(realm_lbl, mean_fe) %>%
  filter(!is.na(prov_lbl)) %>%
  mutate(prov_lbl = fct_inorder(prov_lbl)) %>%
  select(starts_with('chi_'), cell_id, prov_lbl, realm_lbl) %>%
  pivot_longer(names_to = 'method', values_to = 'chi', starts_with('chi'))

prov_means_df <- meow_prov_chi_df %>%
  group_by(realm_lbl, prov_lbl, method) %>%
  summarize(mean = mean(chi, na.rm = TRUE), med = median(chi, na.rm = TRUE))
```

``` {r plot for overall chi by province}
brks <- c('chi_fe', 'chi_hab')
lbls <- c('FE', 'Habitat')

plot_by_province <- function(df, methods, labels) {
  
  if(length(methods) > 2) stop('Function designed for two methods (e.g., FE/Hab)!')
  
  vals <- c('grey70', 'black') ### colors for methods
  p <- ggplot(df %>% filter(method %in% methods), 
              aes(x = prov_lbl, y = chi, fill = method, color = method)) +
    geom_hline(yintercept = 100, color = 'black', size = 2) +
    geom_boxplot(width = .4, position = position_dodge(width = .75),
                 outlier.shape = NA, size = .25) +
    geom_point(data = prov_means_df %>% filter(method %in% methods),
               aes(y = med, group = method), 
               position = position_dodge(width = .75),
               size = 2, shape = 21, color = 'black', fill = 'white') +
    geom_point(data = prov_means_df %>% filter(method %in% methods),
               aes(y = mean, group = method), 
               position = position_dodge(width = .75),
               size = 2, shape = 21, color = 'black', fill = 'black') +
    scale_fill_manual(values = vals, breaks = methods, labels = lbls) +
    scale_color_manual(values = vals, breaks = methods, labels = lbls) +
    scale_y_continuous(limits = c(0, 100), expand = c(0, 0)) +
    coord_flip() +
    theme_minimal() +
    theme(axis.title = element_blank(),
          axis.text  = element_text(family = 'benton', size = 7),
          panel.grid.major.y = element_blank(),
          panel.grid.minor.y = element_blank(),
          strip.text.y = element_text(angle = 90, hjust = .5, 
                                      family = 'bentonbold', size = 7)) +
    facet_grid(rows = vars(realm_lbl), 
               scales = 'free_y', space = 'free_y')
  
  return(p)
}

p <- plot_by_province(df = meow_prov_chi_df, methods = brks, labels = lbls)

meow_prov_plot_f <- 'figSI_meow_prov_chi_plot.png'
ggsave(meow_prov_plot_f, height = 12, width = 6, dpi = 300, units = 'in')

knitr::include_graphics(meow_prov_plot_f)
```

``` {r plot for climate chi by province}
brks <- c('chi_fe_climate', 'chi_hab_climate')
lbls <- c('FE_cc', 'Habitat_cc')

p2 <- plot_by_province(df = meow_prov_chi_df, methods = brks, labels = lbls)

meow_prov_plot_f2 <- 'figSI_meow_prov_climate_plot.png'
ggsave(meow_prov_plot_f2, height = 12, width = 6, dpi = 300, units = 'in')

knitr::include_graphics(meow_prov_plot_f2)
```


``` {r plot for nonclimate chi by province}
brks <- c('chi_fe_noncc', 'chi_hab_noncc')
lbls <- c('FE_non-cc', 'Habitat_non-cc')

p3 <- plot_by_province(df = meow_prov_chi_df, methods = brks, labels = lbls)

meow_prov_plot_f3 <- 'figSI_meow_prov_noncc_plot.png'
ggsave(meow_prov_plot_f3, height = 12, width = 6, dpi = 300, units = 'in')

knitr::include_graphics(meow_prov_plot_f3)
```

### Plot by realm

```{r figure 4 meow by realm, fig.height = 8}

meow_realm_chi_df <- meow_prov_chi_df %>%
  select(-prov_lbl) %>%
  ### In each realm, order by highest to lowest mean impact
  pivot_wider(names_from = 'method', values_from = 'chi') %>%
  group_by(realm_lbl) %>%
  mutate(mean_fe = mean(chi_fe)) %>%
  ungroup() %>%
  arrange(mean_fe) %>%
  mutate(realm_lbl = fct_inorder(realm_lbl)) %>%
  select(starts_with('chi_'), cell_id, realm_lbl) %>%
  pivot_longer(names_to = 'method', values_to = 'chi', starts_with('chi_')) %>%
  filter(!is.na(realm_lbl))

realm_means_df <- meow_realm_chi_df %>%
  group_by(realm_lbl, method) %>%
  summarize(mean = mean(chi, na.rm = TRUE), med = median(chi, na.rm = TRUE))

```

``` {r plot for overall chi by realm}
plot_by_realm <- function(df, methods, labels, x_label) {
  
  if(length(methods) != length(labels)) stop('Break and label vectors must be same length!')
  
  vals <- c('grey70', 'black') ### colors for methods
  plot_df <- df %>% filter(method %in% methods)
  means_df <- realm_means_df %>% filter(method %in% methods)
  
  p <- ggplot(plot_df, 
              aes(y = realm_lbl, x = chi, fill = method, color = method)) +
    # geom_hline(yintercept = 100, color = 'black', size = 2) +
    geom_boxplot(width = .25, position = position_dodge(width = .75),
                 outlier.shape = NA, size = .25) +
    geom_point(data = means_df,
               aes(x = med, group = method),
               position = position_dodge(width = .75),
               size = 1.5, shape = 21, color = 'black', fill = 'white') +
    geom_point(data = realm_means_df %>% filter(method %in% methods),
               aes(x = mean, group = method),
               position = position_dodge(width = .75),
               size = 1.5, shape = 21, color = 'black', fill = 'black') +
    scale_fill_manual(values = vals, breaks = methods, labels = labels) +
    scale_color_manual(values = vals, breaks = methods, labels = labels) +
    scale_x_continuous(limits = c(0, 100), expand = c(0, 0)) +
    theme_minimal() +
    labs(x = x_label) +
    theme(axis.title.y = element_blank(),
          axis.title.x = element_text(family = 'bentonbold', size = 7),
          axis.text  = element_text(family = 'benton', size = 7),
          panel.grid.major.y = element_blank(),
          panel.grid.minor.y = element_blank(),
          legend.text  = element_text(family = 'bentonbold', size = 7),
          legend.key.size = unit(.25, 'cm'),
          legend.title = element_blank())
  
  return(p)
}

# lbls <- unname(latex2exp::TeX(c("$I_{FE}^C$", "$I_{Hab}^C$")))
lbls <- c('FE', 'Hab')
panel_a <- plot_by_realm(df = meow_realm_chi_df, 
                         methods = c('chi_fe', 'chi_hab'), 
                         labels = lbls,
                         x_label = 'Cumulative (%ile)')
panel_b <- plot_by_realm(df = meow_realm_chi_df, 
                         methods = c('chi_fe_climate', 'chi_hab_climate'), 
                         labels = lbls,
                         x_label = 'Climate (%ile)')
panel_c <- plot_by_realm(df = meow_realm_chi_df, 
                         methods = c('chi_fe_noncc', 'chi_hab_noncc'), 
                         labels = lbls,
                         x_label = 'Non-climate (%ile)')

# panel_a; panel_b; panel_c
```

### assemble into three panel figure

```{r assemble figure}
panel_a_plot <- panel_a + theme(legend.position = 'none')
panel_b_plot <- panel_b + 
  theme(legend.position = 'none',
        axis.text.y = element_blank())
panel_c_plot <- panel_c + 
  theme(legend.position = 'none',
        axis.text.y = element_blank())
panel_a_lgd  <- get_legend(panel_a)

### parameterize legends for easier changing of label positions:
lgd_a_xy <- c(x = .90, y = .30, h = .40, w = .10)

fig4 <- ggdraw() +
  ### draw panels:
  draw_plot(panel_a_plot,  x = 0.00, y = 0.00, height = 1.00, width = 0.35) +
  draw_plot(panel_b_plot,  x = 0.35, y = 0.00, height = 1.00, width = 0.28) +
  draw_plot(panel_c_plot,  x = 0.63, y = 0.00, height = 1.00, width = 0.28) +
  ### draw legends:
  draw_plot(panel_a_lgd, x = lgd_a_xy['x'], y = lgd_a_xy['y'], 
            height = lgd_a_xy['h'], width = lgd_a_xy['w']) +
  ### Panel labels:
  draw_label('A', x = 0.002, y = .99, hjust = 0, vjust = 1, 
             size = 10, fontfamily = 'bentonbold') +
  draw_label('B', x = 0.40, y = .99, hjust = 0, vjust = 1, 
             size = 10, fontfamily = 'bentonbold') +
  draw_label('C', x = 0.70, y = .99, hjust = 0, vjust = 1, 
             size = 10, fontfamily = 'bentonbold')


fig4_file <- here('5_ms_figs/fig4_impacts_by_ecoregion.png')
ggsave(fig4_file, width = 12, height = 8, units = 'cm', dpi = 300)

knitr::include_graphics(fig4_file)
```

## Examine impacts by EEZ (georegion)

```{r, fig.height = 8, eval = FALSE}
eez_rgns_df <- read_csv(here('_spatial/eez_rgn_names/rgn_names_ohi.csv')) %>%
  left_join(read_csv(here('_spatial/eez_rgn_names/unsd_methodology.csv')),
            by = 'iso3c') %>%
  janitor::clean_names() %>%
  mutate(ldc = ifelse(!is.na(least_developed_countries), 'LDC', 'not LDC'),
         sids = ifelse(!is.na(small_island_developing_states), 'SIDS', 'not SIDS')) %>%
  select(rgn_id, rgn_label, georgn, geosubrgn, 
         ldc, sids, dev = developed_developing) %>%
  mutate(georgn_lbl = str_replace(georgn, 'Northern', 'N'),
         georgn_lbl = str_replace(georgn_lbl, 'Southern', 'S'),
         georgn_lbl = str_replace(georgn_lbl, 'Atlantic', 'Atl'),
         georgn_lbl = str_replace(georgn_lbl, 'Pacific', 'Pac'),
         georgn_lbl = str_replace(georgn_lbl, 'America', 'Amer'),
         georgn_lbl = str_replace(georgn_lbl, 'Latin', 'Lat'),
         georgn_lbl = str_replace(georgn_lbl, ' and the Caribbean', '/Carib'),
         georgn_lbl = fct_inorder(georgn_lbl)) %>%
  mutate(subrgn_lbl = str_replace(geosubrgn, '(-)?(E|e)ast(ern)?', 'E'),
         subrgn_lbl = str_replace(subrgn_lbl, '(W|w)est(ern)?', 'W'),
         subrgn_lbl = str_replace(subrgn_lbl, 'North(ern)?', 'N'),
         subrgn_lbl = str_replace(subrgn_lbl, 'South(ern)?', 'S'),
         subrgn_lbl = str_replace(subrgn_lbl, 'Atlantic', 'Atl'),
         subrgn_lbl = str_replace(subrgn_lbl, 'Pacific', 'Pac'),
         subrgn_lbl = str_replace(subrgn_lbl, 'Africa', 'Afr'),
         subrgn_lbl = str_replace(subrgn_lbl, 'America', 'Amer'),
         subrgn_lbl = str_replace(subrgn_lbl, 'Australia and New Zealand', 'Aus/NZ'),
         subrgn_lbl = fct_inorder(subrgn_lbl))
eez_chi_df <- chi_df %>%
  left_join(eez_rgns_df, by = c('eez' = 'rgn_id')) %>%
  mutate(fe  = ntile(chi_funct_entity, n = 1000) / 10,
         spp = ntile(chi_species, n = 1000) / 10,
         hab = ntile(chi_habitat, n = 1000) / 10) %>%
  ### In each realm, order by highest to lowest mean impact
  group_by(subrgn_lbl) %>%
  mutate(mean_hab = mean(hab)) %>%
  ungroup() %>%
  arrange(georgn_lbl, mean_hab) %>%
  mutate(subrgn_lbl = fct_inorder(subrgn_lbl)) %>%
  select(fe, spp, hab, cell_id, subrgn_lbl, georgn_lbl, sids, ldc, dev) %>%
  pivot_longer(names_to = 'method', values_to = 'chi', spp, fe, hab) %>%
  filter(!is.na(subrgn_lbl))

means_df <- eez_chi_df %>%
  group_by(georgn_lbl, subrgn_lbl, method) %>%
  summarize(mean = mean(chi), med = median(chi))
  

x <- ggplot(eez_chi_df, aes(x = subrgn_lbl, y = chi, fill = method)) +
  geom_hline(yintercept = 100, color = 'black', size = 2) +
  geom_boxplot(width = .6, position = position_dodge(width = .75),
               outlier.shape = NA, color = 'black', size = .25) +
  geom_point(data = means_df, aes(y = mean, group = method), 
             position = position_dodge(width = .75),
             size = 2, shape = 21, color = 'black', fill = 'cyan') +
  geom_point(data = means_df, aes(y = med, group = method), 
             position = position_dodge(width = .75),
             size = 2, shape = 21, color = 'black', fill = 'white') +
  scale_fill_manual(values = hcl.colors(4)[c(1, 2, 4)], 
                    breaks = c('spp', 'fe', 'hab'),
                    labels = c('spp (eq wt)', 'spp (fv wt)', 'habitat')) +
  scale_y_continuous(limits = c(0, 100), expand = c(0, 0)) +
  coord_flip() +
  theme_minimal(base_family = "Roboto Condensed") +
  theme(axis.title = element_blank(),
        panel.grid.minor.y = element_blank(),
        strip.text.y = element_text(angle = 0, hjust = 0, face = 'bold')) +
  facet_grid(rows = vars(georgn_lbl), 
             scales = 'free_y', space = 'free_y')

ggsave(here('figs/eez_chi_plot.png'), height = 14, width = 6, dpi = 300)

knitr::include_graphics(here('figs/eez_chi_plot.png'))
```

```{r, eval = FALSE}
sids_df <- eez_chi_df %>%
  group_by(georgn_lbl) %>%
  filter(n_distinct(sids) == 2 | sids == 'SIDS')

means_df <- sids_df %>%
  group_by(georgn_lbl, sids, method) %>%
  summarize(mean = mean(chi), med = median(chi))

x <- ggplot(sids_df, aes(x = sids, y = chi, fill = method)) +
  geom_hline(yintercept = 100, color = 'black', size = 2) +
  geom_boxplot(width = .6, position = position_dodge(width = .75),
               outlier.shape = NA, color = 'black', size = .25) +
  geom_point(data = means_df, aes(y = mean, group = method), 
             position = position_dodge(width = .75),
             size = 2, shape = 21, color = 'black', fill = 'cyan') +
  geom_point(data = means_df, aes(y = med, group = method), 
             position = position_dodge(width = .75),
             size = 2, shape = 21, color = 'black', fill = 'white') +
  scale_fill_manual(values = hcl.colors(4)[c(1, 2, 4)], 
                    breaks = c('spp', 'fe', 'hab'),
                    labels = c('spp (eq wt)', 'spp (fv wt)', 'habitat')) +
  scale_y_continuous(limits = c(0, 100), expand = c(0, 0)) +
  coord_flip() +
  theme_minimal(base_family = "Roboto Condensed") +
  theme(axis.title = element_blank(),
        panel.grid.minor.y = element_blank(),
        strip.text.y = element_text(angle = 0, hjust = 0, face = 'bold')) +
  facet_grid(rows = vars(georgn_lbl), 
             scales = 'free_y', space = 'free_y')

ggsave(here('figs/sids_chi_plot.png'), height = 3.5, width = 6, dpi = 300)

knitr::include_graphics(here('figs/sids_chi_plot.png'))

```

```{r, eval = FALSE}
ldc_df <- eez_chi_df %>%
  group_by(georgn_lbl) %>%
  filter(n_distinct(ldc) == 2 | sids == 'LDC')

means_df <- ldc_df %>%
  group_by(georgn_lbl, ldc, method) %>%
  summarize(mean = mean(chi), med = median(chi))

x <- ggplot(sids_df, aes(x = ldc, y = chi, fill = method)) +
  geom_hline(yintercept = 100, color = 'black', size = 2) +
  geom_boxplot(width = .6, position = position_dodge(width = .75),
               outlier.shape = NA, color = 'black', size = .25) +
  geom_point(data = means_df, aes(y = mean, group = method), 
             position = position_dodge(width = .75),
             size = 2, shape = 21, color = 'black', fill = 'cyan') +
  geom_point(data = means_df, aes(y = med, group = method), 
             position = position_dodge(width = .75),
             size = 2, shape = 21, color = 'black', fill = 'white') +
  scale_fill_manual(values = hcl.colors(4)[c(1, 2, 4)], 
                    breaks = c('spp', 'fe', 'hab'),
                    labels = c('spp (eq wt)', 'spp (fv wt)', 'habitat')) +
  scale_y_continuous(limits = c(0, 100), expand = c(0, 0)) +
  coord_flip() +
  theme_minimal(base_family = "Roboto Condensed") +
  theme(axis.title = element_blank(),
        panel.grid.minor.y = element_blank(),
        strip.text.y = element_text(angle = 0, hjust = 0, face = 'bold')) +
  facet_grid(rows = vars(georgn_lbl), 
             scales = 'free_y', space = 'free_y')

ggsave(here('figs/ldc_chi_plot.png'), height = 3.5, width = 6, dpi = 300)

knitr::include_graphics(here('figs/ldc_chi_plot.png'))
```

```{r, eval = FALSE}
means_df <- eez_chi_df %>%
  group_by(georgn_lbl, dev, method) %>%
  summarize(mean = mean(chi), med = median(chi))

x <- ggplot(eez_chi_df, aes(x = dev, y = chi, fill = method)) +
  geom_hline(yintercept = 100, color = 'black', size = 2) +
  geom_boxplot(width = .6, position = position_dodge(width = .75),
               outlier.shape = NA, color = 'black', size = .25) +
  geom_point(data = means_df, aes(y = mean, group = method), 
             position = position_dodge(width = .75),
             size = 2, shape = 21, color = 'black', fill = 'cyan') +
  geom_point(data = means_df, aes(y = med, group = method), 
             position = position_dodge(width = .75),
             size = 2, shape = 21, color = 'black', fill = 'white') +
  scale_fill_manual(values = hcl.colors(4)[c(1, 2, 4)], 
                    breaks = c('spp', 'fe', 'hab'),
                    labels = c('spp (eq wt)', 'spp (fv wt)', 'habitat')) +
  scale_y_continuous(limits = c(0, 100), expand = c(0, 0)) +
  coord_flip() +
  theme_minimal(base_family = "Roboto Condensed") +
  theme(axis.title = element_blank(),
        panel.grid.minor.y = element_blank(),
        strip.text.y = element_text(angle = 0, hjust = 0, face = 'bold')) +
  facet_grid(rows = vars(georgn_lbl), 
             scales = 'free_y', space = 'free_y')

ggsave(here('figs/dev_chi_plot.png'), height = 8, width = 6, dpi = 300)

knitr::include_graphics(here('figs/dev_chi_plot.png'))

```
